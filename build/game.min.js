!function(){var drawBounds=!1;window.Helpers={getObjValues:function(obj){var key,items=obj||{},arr=[];for(key in items)items.hasOwnProperty(key)&&arr.push(items[key]);return arr},getObjKeys:function(obj){var key,items=obj||{},arr=[];for(key in items)items.hasOwnProperty(key)&&arr.push(key);return arr},within:function(value,min,max){return null!=value&&value>=min&&max>=value},withinGrid:function(pos,rows,columns){return pos&&Helpers.within(pos.x,0,columns-1)&&Helpers.within(pos.y,0,rows-1)},setDrawBounds:function(bool){drawBounds=bool},getDrawBounds:function(){return drawBounds}},Function.prototype.inheritsFrom=function(parentClassOrObject){return parentClassOrObject.constructor==Function?(this.prototype=Object.create(parentClassOrObject.prototype),this.prototype.constructor=this,this.prototype.parent=parentClassOrObject.prototype):(this.prototype=parentClassOrObject,this.prototype.constructor=this,this.prototype.parent=parentClassOrObject.prototype),this}}(),function(){function load(urlOrArr){urlOrArr instanceof Array?urlOrArr.forEach(function(url){_load(url)}):_load(urlOrArr)}function _load(url){if(resourceCache[url])return resourceCache[url];var img=new Image;img.onload=function(){resourceCache[url]=img,isReady()&&readyCallbacks.forEach(function(func){func()})},resourceCache[url]=!1,img.src=url}function get(url){return resourceCache[url]}function isReady(){var ready=!0;for(var k in resourceCache)resourceCache.hasOwnProperty(k)&&!resourceCache[k]&&(ready=!1);return ready}function onReady(func){readyCallbacks.push(func)}var resourceCache={},readyCallbacks=[];window.Resources={load:load,get:get,onReady:onReady,isReady:isReady}}(),function(){var blockHeight=83,blockWidth=101,Entity=function(sprite,x,y,offsetX,offsetY,bounds){this.x=x,this.y=y,this.checkBounds=!0,this.offsetX=offsetX||0,this.offsetY=offsetY||0,this.bounds=bounds,this.sprite=sprite,this.sprite&&(this.img=Resources.get(this.sprite))};Entity.prototype={getImage:function(){return this.img=Resources.get(this.sprite),this.img},render:function(ctx){var img=this.getImage();ctx.drawImage(img,this.x*blockWidth+this.offsetX,this.y*blockHeight+this.offsetY),Helpers.getDrawBounds()&&this.checkBounds&&this.drawBounds(ctx)},getBounds:function(){var b=this.bounds||{};return{x:this.x*blockWidth+(b.x||0),y:this.y*blockHeight+(b.y||0),width:b.width||blockWidth,height:b.height||blockHeight}},drawBounds:function(ctx){var b=this.getBounds();b&&(ctx.strokeStyle="#ff0000",ctx.strokeRect(b.x,b.y,b.width,b.height))}};var Block=function(type,x,y){Entity.call(this,Block.types[type],x,y),this.type=type,this.checkBounds=!1};Block.inheritsFrom(Entity),Block.types={grass:"images/grass-block.png",stone:"images/stone-block.png",water:"images/water-block.png"},Block.getSprites=function(){return Helpers.getObjValues(Block.types)};var Player=function(character,x,y){this.character=character;var bounds={x:16,y:blockHeight-30,width:blockWidth-31,height:blockHeight-6};Entity.call(this,Player.characters[character],x,y,0,-10,bounds)};Player.inheritsFrom(Entity),Player.getSprites=function(){return Helpers.getObjValues(Player.characters)},Player.characters={boy:"images/char-boy.png","cat-girl":"images/char-cat-girl.png","pink-girl":"images/char-pink-girl.png"},Player.validMoves={left:[-1,0],right:[1,0],up:[0,-1],down:[0,1]},Player.prototype.move=function(move,rows,columns){var movement=Player.validMoves[move];if(movement&&2==movement.length){var newX=this.x+movement[0],newY=this.y+movement[1];Helpers.withinGrid({x:newX,y:newY},rows,columns)&&(this.x=newX,this.y=newY)}};var Enemy=function(x,y,speed){var bounds={x:2,y:blockHeight-26,width:blockWidth-4,height:blockHeight-16};Entity.call(this,Enemy.sprite,x,y,0,-20,bounds),this.speed=speed};Enemy.inheritsFrom(Entity),Enemy.sprite="images/enemy-bug.png",Enemy.prototype.update=function(dt){this.x+=this.speed*dt},Enemy.prototype.reset=function(){this.x=-1,this.y=Math.floor(3*Math.random()+1),this.speed=1+2*Math.random()},window.Player=Player,window.Block=Block,window.Enemy=Enemy}(),function(){function main(){var now=Date.now(),dt=(now-lastTime)/1e3;paused||update(dt),render(),lastTime=now,win.requestAnimationFrame(main)}function init(){reset(),initEntities(),lastTime=Date.now(),main()}function update(dt){updateEntities(dt)}function updateEntities(dt){allEnemies.forEach(function(enemy){enemy.update(dt),enemy.x>=nColumns&&enemy.reset()})}function render(){ctx.clearRect(0,0,canvas.width,canvas.height),blocks.forEach(function(block){block.render(ctx)}),renderEntities()}function renderEntities(){player.render(ctx),allEnemies.forEach(function(enemy){enemy.render(ctx)})}function reset(){paused=!1}function loadResources(){var images=[];images=images.concat(Player.getSprites()),images=images.concat(Block.getSprites()),images.push(Enemy.sprite),Resources.load(images),Resources.onReady(init)}function initEntities(){allEnemies=[],blocks=[],initBlocks(),initPlayer(),initEnemies()}function initPlayer(){var characters=Helpers.getObjKeys(Player.characters),charInd=Math.floor(Math.random()*characters.length),xPos=Math.floor(Math.random()*nColumns);player=new Player(characters[charInd],xPos,rows.length-1)}function initEnemies(){var i;for(i=0;3>i;i++){var enemy=new Enemy;enemy.reset(),allEnemies.push(enemy)}}function initBlocks(){var row,col;for(row=0;nRows>row;row++)for(col=0;nColumns>col;col++)blocks.push(new Block(rows[row],col,row))}var lastTime,paused,doc=document,win=window,canvas=doc.createElement("canvas"),ctx=canvas.getContext("2d"),nColumns=5,rows=["water","stone","stone","stone","grass","grass"],nRows=rows.length,player=null,allEnemies=[],blocks=[];canvas.width=505,canvas.height=606,doc.body.appendChild(canvas),doc.addEventListener("keyup",function(e){var allowedKeys={37:"left",38:"up",39:"right",40:"down"},move=allowedKeys[e.keyCode];switch(player&&move&&!paused&&player.move(move,nRows,nColumns),e.keyCode){case 27:paused=!paused}}),window.Engine={init:loadResources}}(),Helpers.setDrawBounds(!0),Engine.init();