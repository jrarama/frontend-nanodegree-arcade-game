!function(){window.Helpers={getObjValues:function(obj){var key,items=obj||{},arr=[];for(key in items)items.hasOwnProperty(key)&&arr.push(items[key]);return arr},getObjKeys:function(obj){var key,items=obj||{},arr=[];for(key in items)items.hasOwnProperty(key)&&arr.push(key);return arr},within:function(value,min,max){return null!=value&&value>=min&&max>value},withinGrid:function(pos,rows,columns){return pos&&Helpers.within(pos.x,0,columns)&&Helpers.within(pos.y,0,rows)}}}(),function(){function load(urlOrArr){urlOrArr instanceof Array?urlOrArr.forEach(function(url){_load(url)}):_load(urlOrArr)}function _load(url){if(resourceCache[url])return resourceCache[url];var img=new Image;img.onload=function(){resourceCache[url]=img,isReady()&&readyCallbacks.forEach(function(func){func()})},resourceCache[url]=!1,img.src=url}function get(url){return resourceCache[url]}function isReady(){var ready=!0;for(var k in resourceCache)resourceCache.hasOwnProperty(k)&&!resourceCache[k]&&(ready=!1);return ready}function onReady(func){readyCallbacks.push(func)}var resourceCache={},readyCallbacks=[];window.Resources={load:load,get:get,onReady:onReady,isReady:isReady}}(),function(){var blockHeight=83,Block=function(ctx,type,x,y){this.context=ctx,this.type=type,this.sprite=Block.types[this.type],this.x=x,this.y=y};Block.types={grass:"images/grass-block.png",stone:"images/stone-block.png",water:"images/water-block.png"},Block.getSprites=function(){return Helpers.getObjValues(Block.types)},Block.prototype.render=function(){var img=Resources.get(this.sprite);this.context.drawImage(img,this.x*img.width,this.y*blockHeight)};var Player=function(ctx,character,x,y){this.context=ctx,this.character=character,this.sprite=Player.characters[this.character],this.x=x,this.y=y};Player.getSprites=function(){return Helpers.getObjValues(Player.characters)},Player.characters={boy:"images/char-boy.png","cat-girl":"images/char-cat-girl.png","pink-girl":"images/char-pink-girl.png"},Player.validMoves={left:[-1,0],right:[1,0],up:[0,-1],down:[0,1]},Player.prototype.render=function(){var img=Resources.get(this.sprite);this.context.drawImage(img,this.x*img.width,this.y*blockHeight-10)},Player.prototype.move=function(move,rows,columns){var movement=Player.validMoves[move];if(movement&&2==movement.length){var newX=this.x+movement[0],newY=this.y+movement[1];Helpers.withinGrid({x:newX,y:newY},rows,columns)&&(this.x=newX,this.y=newY)}};var Enemy=function(ctx,x,y,speed){this.context=ctx,this.x=x,this.y=y,this.speed=speed,this.sprite=Enemy.sprite};Enemy.sprite="images/enemy-bug.png",Enemy.prototype.render=function(){var img=Resources.get(this.sprite);this.context.drawImage(img,this.x*img.width,this.y*blockHeight-20)},Enemy.prototype.update=function(dt){this.x+=this.speed*dt},Enemy.prototype.reset=function(){this.x=-1,this.y=Math.floor(3*Math.random()+1),this.speed=1+2*Math.random()},window.Player=Player,window.Block=Block,window.Enemy=Enemy}(),function(global){function main(){var now=Date.now(),dt=(now-lastTime)/1e3;update(dt),render(),lastTime=now,win.requestAnimationFrame(main)}function init(){reset(),initEntities(),lastTime=Date.now(),main()}function update(dt){updateEntities(dt)}function updateEntities(dt){allEnemies.forEach(function(enemy){enemy.update(dt),enemy.x>=columns&&enemy.reset()})}function render(){ctx.clearRect(0,0,canvas.width,canvas.height),blocks.forEach(function(block){block.render()}),renderEntities()}function renderEntities(){player.render(),allEnemies.forEach(function(enemy){enemy.render()})}function reset(){}function loadResources(){var images=[];images=images.concat(Player.getSprites()),images=images.concat(Block.getSprites()),images.push(Enemy.sprite),Resources.load(images),Resources.onReady(init)}function initEntities(){allEnemies=[],blocks=[],initBlocks(),initPlayer(),initEnemies()}function initPlayer(){var characters=Helpers.getObjKeys(Player.characters),charInd=Math.floor(Math.random()*characters.length),xPos=Math.floor(Math.random()*columns);player=new Player(ctx,characters[charInd],xPos,rows.length-1)}function initEnemies(){var i;for(i=0;3>i;i++){var enemy=new Enemy(ctx);enemy.reset(),allEnemies.push(enemy)}}function initBlocks(){var row,col;for(row=0;nRows>row;row++)for(col=0;columns>col;col++)blocks.push(new Block(ctx,rows[row],col,row))}var lastTime,doc=global.document,win=global.window,canvas=doc.createElement("canvas"),ctx=canvas.getContext("2d"),columns=5,rows=["water","stone","stone","stone","grass","grass"],nRows=rows.length,player=null,allEnemies=[],blocks=[];canvas.width=505,canvas.height=606,doc.body.appendChild(canvas),global.ctx=ctx,doc.addEventListener("keyup",function(e){var allowedKeys={37:"left",38:"up",39:"right",40:"down"};player&&player.move(allowedKeys[e.keyCode],nRows,columns)}),window.Engine={init:loadResources}}(this),Engine.init();